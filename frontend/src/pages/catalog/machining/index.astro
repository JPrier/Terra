---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import ManufacturerCard from '../../../components/ManufacturerCard.astro';

// Fetch manufacturer data from S3 (CDK deployed test data)
// In production, this would be fetched from the CDK-deployed S3 bucket
// For now, we'll use the new comprehensive manufacturer data structure

const S3_BASE_URL = import.meta.env.PUBLIC_S3_URL || 'https://your-cloudfront-domain.cloudfront.net';
let manufacturers = [];

try {
  // Fetch catalog data for machining category
  const response = await fetch(`${S3_BASE_URL}/test-data/catalog/category/machining.json`);
  if (response.ok) {
    const catalogData = await response.json();
    manufacturers = catalogData.manufacturers || [];
  } else {
    // Fallback to new test data structure for development
    manufacturers = [
      {
        id: "precision-aerospace-cnc",
        name: "Precision Aerospace CNC",
        city: "Seattle",
        state: "WA",
        logoUrl: null,
        categories: ["CNC Machining", "Aerospace", "Precision Manufacturing"],
        capabilities: [
          "5-axis CNC Machining",
          "Titanium Alloys",
          "Aluminum 7075",
          "Stainless Steel 316L",
          "AS9100 Certified",
          "Prototype to Production",
          "Tight Tolerances ±0.0005\"",
          "Complex Geometries"
        ]
      }
    ];
  }
} catch (error) {
  console.warn('Failed to fetch manufacturer data from S3, using fallback data:', error);
  // Fallback data with new enhanced manufacturer
  manufacturers = [
    {
      id: "precision-aerospace-cnc",
      name: "Precision Aerospace CNC",
      city: "Seattle",
      state: "WA",
      logoUrl: null,
      categories: ["CNC Machining", "Aerospace", "Precision Manufacturing"],
      capabilities: [
        "5-axis CNC Machining",
        "Titanium Alloys",
        "Aluminum 7075",
        "Stainless Steel 316L",
        "AS9100 Certified",
        "Prototype to Production",
        "Tight Tolerances ±0.0005\"",
        "Complex Geometries"
      ]
    }
  ];
}
---

<BaseLayout title="CNC Machining Manufacturers - Terra">
  <section class="hero">
    <h2>CNC Machining Manufacturers</h2>
    <p>Find verified US-based CNC machining manufacturers for your precision manufacturing needs.</p>
  </section>

  <div class="catalog-stats">
    <p><strong>{manufacturers.length}</strong> verified manufacturers in CNC Machining</p>
  </div>

  <div class="manufacturer-grid">
    {manufacturers.map(manufacturer => (
      <ManufacturerCard manufacturer={manufacturer} />
    ))}
  </div>

  <div class="cta-section">
    <div class="card">
      <h3>Don't see what you need?</h3>
      <p>Submit an RFQ and we'll connect you with the right manufacturers for your project.</p>
      <a href={`${import.meta.env.BASE_URL}rfq/submit`} class="btn btn-primary">Submit RFQ</a>
    </div>
  </div>
</BaseLayout>

<style>
  .catalog-stats {
    text-align: center;
    margin: 2rem 0;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .manufacturer-grid {
    display: grid;
    gap: 1.5rem;
    margin: 2rem 0;
  }

  .cta-section {
    margin-top: 3rem;
    text-align: center;
  }

  @media (min-width: 768px) {
    .manufacturer-grid {
      grid-template-columns: 1fr;
    }
  }
</style>