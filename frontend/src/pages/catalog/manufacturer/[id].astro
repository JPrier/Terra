---
// Dynamic manufacturer route that serves pre-rendered HTML from S3

export async function getStaticPaths() {
  // For build time, use some example manufacturer IDs since S3 may not be available
  // In production, these would be generated dynamically by the Lambda
  const fallbackManufacturerIds = ['acme-precision', 'stellar-manufacturing', 'apex-industries', 'precision-parts-co', 'midwest-machining'];
  
  return fallbackManufacturerIds.map(id => ({
    params: { id }
  }));
}

// Get the manufacturer ID from the route parameters
const { id } = Astro.params;

// Fetch the pre-rendered HTML from S3
const S3_BASE_URL = import.meta.env.PUBLIC_S3_URL || 'https://your-cloudfront-domain.cloudfront.net';
let htmlContent = '';
let errorMessage = '';

try {
  const htmlUrl = `${S3_BASE_URL}/test-data/catalog/manufacturer/${id}/index.html`;
  const response = await fetch(htmlUrl);
  
  if (response.ok) {
    htmlContent = await response.text();
  } else {
    errorMessage = `Could not load content for manufacturer: ${id}`;
    console.error('Failed to fetch pre-rendered manufacturer HTML:', response.status, response.statusText);
  }
} catch (error) {
  errorMessage = `Could not load content for manufacturer: ${id}`;
  console.error('Error fetching pre-rendered manufacturer HTML:', error);
}
---

{errorMessage ? (
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Manufacturer Not Found - Terra</title>
    </head>
    <body>
      <div style="text-align: center; padding: 2rem;">
        <h1>Manufacturer Not Found</h1>
        <p>{errorMessage}</p>
        <a href="/">Return to Home</a>
        <a href="/catalog/machining/" style="margin-left: 1rem;">Browse Manufacturers</a>
      </div>
    </body>
  </html>
) : (
  <!-- Serve the pre-rendered HTML directly -->
  <Fragment set:html={htmlContent} />
)}